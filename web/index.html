<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TORM - Goè¯­è¨€çš„ä¼˜é›…ORMåº“</title>
    <link rel="icon" href="assets/logo.svg" type="image/x-icon">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="assets/logo.svg" alt="TORM" class="logo">
                <span class="brand-text">TORM</span>
            </div>
            <div class="nav-menu" id="nav-menu">
                <a href="docs.html" class="nav-link">æ–‡æ¡£</a>
                <a href="docs.html?doc=examples" class="nav-link">ç¤ºä¾‹</a>
                <a href="#" class="nav-link">ç¤¾åŒº</a>
                <a href="#" class="nav-link">API</a>
                <a href="docs.html?doc=contributing" class="nav-link">è´¡çŒ®</a>
                <div class="language-selector">
                    <select id="language-select">
                        <option value="zh">ç®€ä½“ä¸­æ–‡</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
            <div class="nav-toggle" id="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- ä¸»é¡µå†…å®¹ -->
    <main class="main-content">
        <!-- è‹±é›„åŒºåŸŸ -->
        <section class="hero">
            <div class="hero-background"></div>
            <div class="container">
                <div class="hero-content">
                    <h1 class="hero-title">
                        <span class="hero-title-main">TORM</span>
                        <span class="hero-title-sub">Goè¯­è¨€çš„ä¼˜é›…ORMåº“</span>
                    </h1>
                    <div class="hero-install">
                        <code class="install-command">go get -u github.com/zhoudm1743/torm</code>
                        <button class="copy-btn" id="copy-install-btn">å¤åˆ¶</button>
                    </div>
                    <div class="hero-stats">
                        <div class="stat-item">
                            <span class="stat-icon">â­</span>
                            <span class="stat-text">GitHub stars</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">ğŸ´</span>
                            <span class="stat-text">GitHub forks</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">ğŸ‘¥</span>
                            <span class="stat-text">è´¡çŒ®è€…</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç‰¹æ€§å±•ç¤º -->
        <section class="features">
            <div class="container">
                <h2 class="section-title">ä¸ºä»€ä¹ˆé€‰æ‹©TORMï¼Ÿ</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">ğŸš€</div>
                        <h3>é«˜æ€§èƒ½</h3>
                        <p>ä¼˜åŒ–çš„æŸ¥è¯¢æ„å»ºå™¨å’Œè¿æ¥æ± ç®¡ç†ï¼Œä¸ºæ‚¨çš„åº”ç”¨æä¾›æè‡´æ€§èƒ½</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ”—</div>
                        <h3>å…³è”å…³ç³»</h3>
                        <p>å®Œæ•´æ”¯æŒ has oneã€has manyã€belongs toã€many to many ç­‰å…³è”å…³ç³»</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸª</div>
                        <h3>é’©å­å‡½æ•°</h3>
                        <p>æ”¯æŒ before/after create/save/update/delete/find ç­‰ç”Ÿå‘½å‘¨æœŸé’©å­</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ“Š</div>
                        <h3>æ•°æ®è¿ç§»</h3>
                        <p>å†…ç½®å¼ºå¤§çš„æ•°æ®åº“è¿ç§»å·¥å…·ï¼Œè½»æ¾ç®¡ç†æ•°æ®åº“ç‰ˆæœ¬</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ’¾</div>
                        <h3>å¤šæ•°æ®åº“æ”¯æŒ</h3>
                        <p>æ”¯æŒ MySQLã€PostgreSQLã€SQLiteã€MongoDB ç­‰å¤šç§æ•°æ®åº“</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ”’</div>
                        <h3>äº‹åŠ¡å¤„ç†</h3>
                        <p>å®Œæ•´çš„äº‹åŠ¡æ”¯æŒï¼ŒåŒ…æ‹¬åµŒå¥—äº‹åŠ¡ã€ä¿å­˜ç‚¹ç­‰é«˜çº§åŠŸèƒ½</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ¯</div>
                        <h3>æŸ¥è¯¢æ„å»ºå™¨</h3>
                        <p>å¼ºå¤§çš„ SQL æŸ¥è¯¢æ„å»ºå™¨ï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢å’Œå­æŸ¥è¯¢</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ§°</div>
                        <h3>å¼€å‘å‹å¥½</h3>
                        <p>è¯¦ç»†çš„æ–‡æ¡£ã€ä¸°å¯Œçš„ç¤ºä¾‹ï¼Œè®©å¼€å‘æ›´åŠ è½»æ¾æ„‰å¿«</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ä»£ç ç¤ºä¾‹ -->
        <section class="code-demo">
            <div class="container">
                <h2 class="section-title">å¿«é€Ÿä¸Šæ‰‹</h2>
                <div class="demo-tabs">
                    <button class="tab-btn active" data-tab="basic">åŸºç¡€æ“ä½œ</button>
                    <button class="tab-btn" data-tab="model">æ¨¡å‹æ“ä½œ</button>
                    <button class="tab-btn" data-tab="migration">æ•°æ®è¿ç§»</button>
                    <button class="tab-btn" data-tab="transaction">äº‹åŠ¡å¤„ç†</button>
                </div>
                <div class="demo-content">
                    <div class="tab-content active" id="basic">
                        <pre><code class="language-go">package main

import (
    "log"
    
    "github.com/zhoudm1743/torm/db"
)

type User struct {
    ID        int    `db:"id" json:"id"`
    Name      string `db:"name" json:"name"`
    Email     string `db:"email" json:"email"`
    Age       int    `db:"age" json:"age"`
    Status    string `db:"status" json:"status"`
    CreatedAt string `db:"created_at" json:"created_at"`
    UpdatedAt string `db:"updated_at" json:"updated_at"`
}

func main() {
    // é…ç½®æ•°æ®åº“è¿æ¥
    config := &db.Config{
        Driver:   "mysql",
        Host:     "localhost",
        Port:     3306,
        Username: "root",
        Password: "password",
        Database: "torm_example",
    }
    err := db.AddConnection("default", config)
    if err != nil {
        log.Fatal(err)
    }
    
    // ===== TORMæŸ¥è¯¢æ„å»ºå™¨æ¼”ç¤º =====
    log.Println("===== TORMæŸ¥è¯¢æ„å»ºå™¨æ¼”ç¤º =====")

    // åŸºç¡€æŸ¥è¯¢
    query, err := db.Table("users", "default")
    if err == nil {
        // æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
        users, err := query.Select("id", "name", "email", "age").
            Where("status", "=", "active").
            OrderBy("created_at", "desc").
            Limit(5).
            Get()
        if err == nil {
            log.Printf("æŸ¥è¯¢åˆ° %d ä¸ªæ´»è·ƒç”¨æˆ·", len(users))
        }

        // æ¡ä»¶æŸ¥è¯¢
        adults, err := query.Where("age", ">=", 18).
            Where("status", "=", "active").
            Count()
        if err == nil {
            log.Printf("æˆå¹´æ´»è·ƒç”¨æˆ·æ•°é‡: %d", adults)
        }
    }

    // ===== TORMæ”¯æŒä¸¤ç§æŸ¥è¯¢æ–¹å¼ =====
    log.Println("===== TORMæ”¯æŒä¸¤ç§æŸ¥è¯¢æ–¹å¼ =====")
    
    // æ–¹å¼1: ä¼ ç»Ÿä¸‰å‚æ•°æ–¹å¼
    users, err := query.Where("age", ">", 18).
        Where("status", "=", "active").Get()
    if err == nil {
        log.Printf("ä¼ ç»Ÿæ–¹å¼æŸ¥è¯¢ç”¨æˆ·: %d ä¸ª", len(users))
    }
    
    // æ–¹å¼2: å‚æ•°åŒ–æŸ¥è¯¢æ–¹å¼
    users, err = query.Where("name = ?", "å¼ ä¸‰").Get()
    if err == nil {
        log.Printf("å‚æ•°åŒ–æŸ¥è¯¢ç”¨æˆ·: %d ä¸ª", len(users))
    }
    
    // æ–¹å¼3: æ··åˆä½¿ç”¨ä¸¤ç§æ–¹å¼
    users, err = query.Where("age", ">=", 18).        // ä¼ ç»Ÿæ–¹å¼
        Where("name LIKE ?", "%ç‹%").                  // å‚æ•°åŒ–æ–¹å¼
        Where("status", "=", "active").               // ä¼ ç»Ÿæ–¹å¼
        Where("email IS NOT NULL").Get()              // åŸç”ŸSQL
    if err == nil {
        log.Printf("æ··åˆæŸ¥è¯¢ç”¨æˆ·: %d ä¸ª", len(users))
    }

    // ===== Firstå’ŒFindå¢å¼ºåŠŸèƒ½æ¼”ç¤º =====
    log.Println("===== Firstå’ŒFindå¢å¼ºåŠŸèƒ½æ¼”ç¤º =====")
    
    // æŸ¥è¯¢å•ä¸ªç”¨æˆ· - å‚æ•°åŒ–æ–¹å¼
    var user User
    _, err = query.Where("id = ?", 1).First(&user)
    if err == nil {
        log.Printf("ç”¨æˆ·ä¿¡æ¯: %s (%s)", user.Name, user.Email)
    }
    
    // æŸ¥è¯¢å•ä¸ªç”¨æˆ· - ä¼ ç»Ÿæ–¹å¼
    var user2 User
    _, err = query.Where("id", "=", 1).First(&user2)
    if err == nil {
        log.Printf("ç”¨æˆ·ä¿¡æ¯(ä¼ ç»Ÿæ–¹å¼): %s (%s)", user2.Name, user2.Email)
    }
    
    // æŸ¥è¯¢å¤šä¸ªç”¨æˆ· - æ··åˆæ–¹å¼
    var userList []User
    _, err = query.Where("status", "=", "active").         // ä¼ ç»Ÿæ–¹å¼
        Where("age >= ?", 18).                             // å‚æ•°åŒ–æ–¹å¼
        Find(&userList)
    if err == nil {
        log.Printf("æˆå¹´æ´»è·ƒç”¨æˆ·æ•°é‡: %d", len(userList))
    }

    // ===== é«˜çº§æŸ¥è¯¢åŠŸèƒ½æ¼”ç¤º =====
    log.Println("===== é«˜çº§æŸ¥è¯¢åŠŸèƒ½æ¼”ç¤º =====")
    
    // å¤æ‚æ¡ä»¶æŸ¥è¯¢
    complexQuery, err := db.Table("users", "default")
    if err == nil {
        result, err := complexQuery.
            Select("id", "name", "email").
            Where("age BETWEEN ? AND ?", 20, 40).
            Where("status IN (?, ?)", "active", "pending").
            OrderBy("age", "ASC").
            OrderBy("name", "DESC").
            Limit(10).
            Get()
        if err == nil {
            log.Printf("å¤æ‚æŸ¥è¯¢ç»“æœæ•°é‡: %d", len(result))
        }
    }

    log.Println("===== TORMæ¼”ç¤ºå®Œæˆ =====")
}</code></pre>
                    </div>
                    <div class="tab-content" id="model">
                        <pre><code class="language-go">package main

import (
    "errors"
    "log"
    "time"
    
    "github.com/zhoudm1743/torm/db"
    "github.com/zhoudm1743/torm/model"
)

// User ç”¨æˆ·æ¨¡å‹ - æ”¯æŒæ ‡ç­¾é…ç½®
type User struct {
    model.BaseModel                                           // åµŒå…¥åŸºç¡€æ¨¡å‹
    ID        uint       `json:"id" db:"id" pk:""`           // ä¸»é”®ï¼Œpkæ ‡ç­¾
    Name      string     `json:"name" db:"name"`             // ç”¨æˆ·å
    Email     string     `json:"email" db:"email"`           // é‚®ç®±
    Age       int        `json:"age" db:"age"`               // å¹´é¾„
    Status    string     `json:"status" db:"status"`         // çŠ¶æ€
    CreatedAt time.Time  `json:"created_at" db:"created_at;autoCreateTime"` // è‡ªåŠ¨åˆ›å»ºæ—¶é—´
    UpdatedAt time.Time  `json:"updated_at" db:"updated_at;autoUpdateTime"` // è‡ªåŠ¨æ›´æ–°æ—¶é—´
    DeletedAt model.DeletedTime `json:"deleted_at" db:"deleted_at"`          // è½¯åˆ é™¤æ—¶é—´
}

// NewUser åˆ›å»ºç”¨æˆ·æ¨¡å‹å®ä¾‹
func NewUser() *User {
    user := &User{
        BaseModel: *model.NewBaseModel(), // BaseModelå†…ç½®db.QueryInterface
    }
    user.SetTable("users")        // è®¾ç½®è¡¨å
    user.SetConnection("default") // è®¾ç½®æ•°æ®åº“è¿æ¥
    user.DetectConfigFromStruct(user) // ä»ç»“æ„ä½“æ ‡ç­¾æ£€æµ‹é…ç½®ï¼ˆä¼˜å…ˆçº§é«˜äºåŸºç¡€é…ç½®ï¼‰
    return user
}

// è‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³• - æ´»è·ƒç”¨æˆ·ï¼ˆå‚æ•°åŒ–æŸ¥è¯¢ï¼‰
func (u *User) GetActiveUsers() ([]map[string]interface{}, error) {
    return u.Where("status = ?", "active").Get()
}

// è‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³• - å¤åˆæ¡ä»¶ï¼ˆå‚æ•°åŒ–æŸ¥è¯¢ï¼‰
func (u *User) GetActiveAdults() ([]map[string]interface{}, error) {
    return u.Where("status = ? AND age >= ?", "active", 18).Get()
}

// ç”Ÿå‘½å‘¨æœŸé’©å­ - ä¿å­˜å‰éªŒè¯
func (u *User) BeforeSave() error {
    if u.GetAttribute("email") == "" {
        return errors.New("é‚®ç®±ä¸èƒ½ä¸ºç©º")
    }
    return nil
}

// ç”Ÿå‘½å‘¨æœŸé’©å­ - åˆ›å»ºåå¤„ç†
func (u *User) AfterCreate() error {
    log.Printf("æ–°ç”¨æˆ·åˆ›å»º: %s", u.GetAttribute("name"))
    return nil
}

func main() {
    // é…ç½®æ•°æ®åº“è¿æ¥
    config := &db.Config{
        Driver:   "mysql",
        Host:     "localhost",
        Port:     3306,
        Username: "root",
        Password: "password",
        Database: "torm_example",
    }
    err := db.AddConnection("default", config)
    if err != nil {
        log.Fatal(err)
    }
    
    // TORMæ¨¡å‹ç³»ç»Ÿè¯´æ˜ï¼š
    // 1. æ¨¡å‹å†…ç½®ä½¿ç”¨dbåŒ…çš„QueryInterfaceè¿›è¡Œæ•°æ®åº“æ“ä½œ
    // 2. é€šè¿‡getQueryBuilder()æ–¹æ³•è·å–db.Table()æŸ¥è¯¢æ„å»ºå™¨
    // 3. æ‰€æœ‰Whereã€Getã€Firstç­‰æ–¹æ³•éƒ½æ˜¯å¯¹dbåŒ…æŸ¥è¯¢æ„å»ºå™¨çš„å°è£…
    // 4. æ”¯æŒå‚æ•°åŒ–æŸ¥è¯¢: Where("name = ?", value) å’Œä¼ ç»ŸæŸ¥è¯¢: Where("name", "=", value)
    // 5. é»˜è®¤æ“ä½œå½“å‰æ¨¡å‹è¡¨ï¼ŒJOINæŸ¥è¯¢æ™ºèƒ½å¤„ç†è¡¨åå‰ç¼€
    
    // ===== åˆ›å»ºç”¨æˆ· =====
    log.Println("===== åˆ›å»ºç”¨æˆ· =====")
    
    // æ–¹å¼1ï¼šç›´æ¥åˆ›å»º
    user1 := NewUser()
    user1.Name = "å¼ ä¸‰"
    user1.Email = "zhangsan@example.com"
    user1.Age = 25
    user1.Status = "active"
    err = user1.Save()
    if err != nil {
        log.Printf("åˆ›å»ºç”¨æˆ·å¤±è´¥: %v", err)
    } else {
        log.Printf("ç”¨æˆ· %s åˆ›å»ºæˆåŠŸï¼ŒID: %v", user1.Name, user1.GetKey())
    }
    
    // æ–¹å¼2ï¼šæ‰¹é‡è®¾ç½®å±æ€§
    user2 := NewUser()
    err = user2.Fill(map[string]interface{}{
        "name":   "æå››",
        "email":  "lisi@example.com",
        "age":    30,
        "status": "active",
    }).Save()
    if err != nil {
        log.Printf("åˆ›å»ºç”¨æˆ·å¤±è´¥: %v", err)
    } else {
        log.Printf("ç”¨æˆ·æ‰¹é‡åˆ›å»ºæˆåŠŸ")
    }
    
    // ===== æŸ¥è¯¢ç”¨æˆ· =====
    log.Println("===== æŸ¥è¯¢ç”¨æˆ· =====")
    
    // æ ¹æ®ä¸»é”®æŸ¥æ‰¾
    user := NewUser()
    err = user.Find(1)
    if err == nil {
        log.Printf("æ‰¾åˆ°ç”¨æˆ·: %s (%s)", user.Name, user.Email)
    }
    
    // ä½¿ç”¨è‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³•
    activeUsers := NewUser()
    users, err := activeUsers.GetActiveUsers()
    if err == nil {
        log.Printf("æ´»è·ƒç”¨æˆ·æ•°é‡: %d", len(users))
    }
    
    // å¤åˆæ¡ä»¶æŸ¥è¯¢ï¼ˆæ´»è·ƒä¸”æˆå¹´ï¼‰- å‚æ•°åŒ–æ–¹å¼
    adultActiveUsers := NewUser()
    users, err = adultActiveUsers.GetActiveAdults()
    if err == nil {
        log.Printf("æ´»è·ƒæˆå¹´ç”¨æˆ·æ•°é‡: %d", len(users))
    }
    
    // åŸç”ŸSQLæŸ¥è¯¢
    rawQueryUsers := NewUser()
    users, err = rawQueryUsers.WhereRaw("YEAR(created_at) = ? AND status = ?", 2024, "active").Get()
    if err == nil {
        log.Printf("2024å¹´åˆ›å»ºçš„æ´»è·ƒç”¨æˆ·: %d", len(users))
    }
    
    // JOINæŸ¥è¯¢ - è‡ªåŠ¨å¤„ç†æ¨¡å‹è¡¨å
    joinUsers := NewUser()
    joinResults, err := joinUsers.
        LeftJoin("user_profiles", "user_id", "=", "id").  // è‡ªåŠ¨å¤„ç†ï¼šuser_profiles.user_id = users.id
        Select("users.*", "user_profiles.avatar").
        Where("status = ?", "active").                    // è‡ªåŠ¨ä½¿ç”¨users.status
        Get()
    if err == nil {
        log.Printf("æ™ºèƒ½JOINæŸ¥è¯¢ç»“æœ: %d æ¡è®°å½•", len(joinResults))
    }
    
    // åˆ†ç»„æŸ¥è¯¢ - é€‚é…db.GroupByåŠŸèƒ½
    groupUsers := NewUser()
    groupResults, err := groupUsers.
        SelectRaw("status, COUNT(*) as count").
        GroupBy("status").
        Having("count", ">", 0).
        Get()
    if err == nil {
        log.Printf("æŒ‰çŠ¶æ€åˆ†ç»„ç»“æœ: %d ä¸ªç»„", len(groupResults))
    }
    
    // ä½¿ç”¨æ¨¡å‹çš„Whereæ–¹æ³•ï¼ˆä¼ ç»Ÿä¸‰å‚æ•°æ–¹å¼ï¼‰
    user3 := NewUser()
    err = user3.Where("email", "=", "zhangsan@example.com").First()
    if err == nil {
        log.Printf("é€šè¿‡é‚®ç®±æ‰¾åˆ°ç”¨æˆ·: %s", user3.Name)
    }
    
    // å‚æ•°åŒ–æŸ¥è¯¢æ–¹å¼
    user4 := NewUser()
    err = user4.Where("name = ? AND age >= ?", "æå››", 25).First()
    if err == nil {
        log.Printf("é€šè¿‡å‚æ•°åŒ–æŸ¥è¯¢æ‰¾åˆ°ç”¨æˆ·: %s", user4.Name)
    }
    
    // æ··åˆæŸ¥è¯¢æ–¹å¼
    user5 := NewUser()
    err = user5.Where("status", "=", "active").           // ä¼ ç»Ÿæ–¹å¼
        Where("name LIKE ?", "%æ%").                      // å‚æ•°åŒ–æ–¹å¼
        OrWhere("email = ?", "admin@example.com").        // ORå‚æ•°åŒ–æ–¹å¼
        First()
    if err == nil {
        log.Printf("é€šè¿‡æ··åˆæŸ¥è¯¢æ‰¾åˆ°ç”¨æˆ·: %s", user5.Name)
    }
    
    // ===== æ›´æ–°ç”¨æˆ· =====
    log.Println("===== æ›´æ–°ç”¨æˆ· =====")
    
    updateUser := NewUser()
    err = updateUser.Find(1)
    if err == nil {
        updateUser.Age = 26
        updateUser.Status = "premium"
        err = updateUser.Save()
        if err == nil {
            log.Printf("ç”¨æˆ·æ›´æ–°æˆåŠŸ: %s, æ–°å¹´é¾„: %d", updateUser.Name, updateUser.Age)
        }
    }
    
    // æ‰¹é‡æ›´æ–° - é€‚é…db.Update
    updateUser := NewUser()
    affectedRows, err := updateUser.Where("status = ?", "active").
        Update(map[string]interface{}{
            "status": "verified",
        })
    if err == nil {
        log.Printf("æ‰¹é‡æ›´æ–°äº† %d ä¸ªç”¨æˆ·çŠ¶æ€", affectedRows.(int64))
    }
    
    // æ‰¹é‡æ’å…¥ - é€‚é…db.InsertBatch
    batchUser := NewUser()
    insertedCount, err := batchUser.InsertBatch([]map[string]interface{}{
        {"name": "æ‰¹é‡ç”¨æˆ·1", "email": "batch1@example.com", "age": 25, "status": "active"},
        {"name": "æ‰¹é‡ç”¨æˆ·2", "email": "batch2@example.com", "age": 30, "status": "active"},
        {"name": "æ‰¹é‡ç”¨æˆ·3", "email": "batch3@example.com", "age": 28, "status": "active"},
    })
    if err == nil {
        log.Printf("æ‰¹é‡æ’å…¥äº† %d ä¸ªç”¨æˆ·", insertedCount)
    }
    
    // ===== é«˜çº§æŸ¥è¯¢ =====
    log.Println("===== é«˜çº§æŸ¥è¯¢ =====")
    
    // èšåˆæŸ¥è¯¢
    countUser := NewUser()
    count, err := countUser.Where("status", "=", "active").Count()
    if err == nil {
        log.Printf("æ´»è·ƒç”¨æˆ·æ•°é‡: %d", count)
    }
    
    // æ£€æŸ¥è®°å½•æ˜¯å¦å­˜åœ¨
    existsUser := NewUser()
    exists, err := existsUser.Where("email", "=", "zhangsan@example.com").HasRecords()
    if err == nil {
        log.Printf("é‚®ç®± zhangsan@example.com æ˜¯å¦å­˜åœ¨: %t", exists)
    }
    
    // åˆ†é¡µæŸ¥è¯¢
    result, err := NewUser().
        Where("status", "=", "active").
        OrderBy("created_at", "desc").
        Paginate(1, 5) // ç¬¬1é¡µï¼Œæ¯é¡µ5æ¡
    if err == nil {
        log.Printf("åˆ†é¡µæŸ¥è¯¢ç»“æœ: å…±%dæ¡ï¼Œå½“å‰é¡µ%dæ¡", 
            result.Total, len(result.Data))
    }
    
    // ===== æ¨¡å‹åºåˆ—åŒ– =====
    log.Println("===== æ¨¡å‹åºåˆ—åŒ– =====")
    
    serializeUser := NewUser()
    err = serializeUser.Find(1)
    if err == nil {
        // è½¬æ¢ä¸ºMap
        userData := serializeUser.ToMap()
        log.Printf("ç”¨æˆ·Map: %+v", userData)
        
        // è·å–æ‰€æœ‰å±æ€§
        attributes := serializeUser.GetAttributes()
        log.Printf("ç”¨æˆ·å±æ€§: %+v", attributes)
        
        // è·å–ä¸»é”®å€¼
        keyValue := serializeUser.GetKey()
        log.Printf("ç”¨æˆ·ä¸»é”®: %v", keyValue)
    }
    
    // ===== æŸ¥è¯¢æ„å»ºå™¨æ¨¡å‹æ”¯æŒæ¼”ç¤º =====
    log.Println("===== æŸ¥è¯¢æ„å»ºå™¨æ¨¡å‹æ”¯æŒæ¼”ç¤º =====")
    
    // ç›´æ¥ä»æ¨¡å‹åˆ›å»ºæŸ¥è¯¢æ„å»ºå™¨ - è‡ªåŠ¨è·å–è¡¨åå’Œå¯ç”¨æ¨¡å‹ç‰¹æ€§
    userModel := &User{}
    userModel.SetTable("custom_users") // å¯é€‰ï¼šæ‰‹åŠ¨è®¾ç½®è¡¨åï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
    modelQuery, err := db.Model(userModel)
    if err == nil {
        
                // æ’å…¥æ¨¡å‹å®ä¾‹ - è‡ªåŠ¨å¤„ç†æ—¶é—´æˆ³
        newUser := &User{
            Name:   "æ•°æ®åº“ç”¨æˆ·",
            Email:  "db@example.com",
            Age:    28,
            Status: "active",
        }
        insertedID, err := modelQuery.InsertModel(newUser)
        if err == nil {
            log.Printf("æŸ¥è¯¢æ„å»ºå™¨æ’å…¥ç”¨æˆ·æˆåŠŸï¼ŒID: %d", insertedID)
        }
        
        // æŸ¥æ‰¾æ¨¡å‹ - è‡ªåŠ¨å¡«å……ç»“æ„ä½“ï¼Œè‡ªåŠ¨è¿‡æ»¤è½¯åˆ é™¤è®°å½•
        var foundUser User
        err = modelQuery.FindModel(insertedID, &foundUser)
        if err == nil {
            log.Printf("æŸ¥è¯¢æ„å»ºå™¨æ‰¾åˆ°ç”¨æˆ·: %s (%s)", foundUser.Name, foundUser.Email)
        }
        
        // æ›´æ–°æ¨¡å‹ - è‡ªåŠ¨å¤„ç†æ›´æ–°æ—¶é—´æˆ³
        foundUser.Age = 29
        foundUser.Status = "premium"
        affected, err := modelQuery.Where("id = ?", insertedID).UpdateModel(&foundUser)
        if err == nil {
            log.Printf("æŸ¥è¯¢æ„å»ºå™¨æ›´æ–°ç”¨æˆ·æˆåŠŸï¼Œå½±å“è¡Œæ•°: %d", affected)
        }
        
        // è‡ªåŠ¨è½¯åˆ é™¤è¿‡æ»¤ - åªæŸ¥è¯¢æœªåˆ é™¤çš„è®°å½•
        activeUsers, err := modelQuery.Where("status = ?", "active").Get()
        if err == nil {
            log.Printf("æŸ¥è¯¢åˆ° %d ä¸ªæ´»è·ƒç”¨æˆ·ï¼ˆè‡ªåŠ¨æ’é™¤è½¯åˆ é™¤ï¼‰", len(activeUsers))
        }
    }
    
    log.Println("===== æ¨¡å‹æ“ä½œæ¼”ç¤ºå®Œæˆ =====")
}</code></pre>
                    </div>
                    <div class="tab-content" id="migration">
                        <pre><code class="language-go">package main

import (
    "fmt"
    "log"
    
    "github.com/zhoudm1743/torm/db"
    "github.com/zhoudm1743/torm/migration"
)

func main() {
    // é…ç½®æ•°æ®åº“è¿æ¥
    config := &db.Config{
        Driver:   "sqlite",
        Database: "example.db",
    }
    
    err := db.AddConnection("default", config)
    if err != nil {
        log.Fatal(err)
    }
    
    // è·å–æ•°æ®åº“è¿æ¥
    conn, err := db.DB("default")
    if err != nil {
        log.Fatal(err)
    }
    
    err = conn.Connect()
    if err != nil {
        log.Fatal(err)
    }
    
    // åˆ›å»ºè¿ç§»å™¨
    migrator := migration.NewMigrator(conn, nil)
    
    // æ³¨å†Œç”¨æˆ·è¡¨è¿ç§» - ä½¿ç”¨ç°ä»£åŒ–çš„ç»“æ„å®šä¹‰
    migrator.Register("20240101_000001", "åˆ›å»ºç”¨æˆ·è¡¨", 
        func(conn db.ConnectionInterface) error {
            // ä½¿ç”¨Tableç»“æ„å®šä¹‰è¡¨
            table := &migration.Table{
                Name: "users",
                Columns: []*migration.Column{
                    {Name: "id", Type: migration.ColumnTypeBigInt, PrimaryKey: true, AutoIncrement: true},
                    {Name: "name", Type: migration.ColumnTypeVarchar, Length: 100, NotNull: true},
                    {Name: "email", Type: migration.ColumnTypeVarchar, Length: 100, NotNull: true},
                    {Name: "age", Type: migration.ColumnTypeInt, NotNull: true, Default: "0"},
                    {Name: "status", Type: migration.ColumnTypeVarchar, Length: 20, Default: "'active'"},
                    {Name: "created_at", Type: migration.ColumnTypeDateTime, Default: "CURRENT_TIMESTAMP"},
                    {Name: "updated_at", Type: migration.ColumnTypeDateTime, Default: "CURRENT_TIMESTAMP"},
                },
                Indexes: []*migration.Index{
                    {Name: "idx_users_email", Columns: []string{"email"}, Unique: true},
                    {Name: "idx_users_status", Columns: []string{"status"}},
                },
            }
            
            schema := migration.NewSchemaBuilder(conn)
            return schema.CreateTable(table)
        },
        func(conn db.ConnectionInterface) error {
            schema := migration.NewSchemaBuilder(conn)
            return schema.DropTable("users")
        },
    )
    
    // æ³¨å†Œæ–‡ç« è¡¨è¿ç§»
    migrator.Register("20240101_000002", "åˆ›å»ºæ–‡ç« è¡¨",
        func(conn db.ConnectionInterface) error {
            table := &migration.Table{
                Name: "posts",
                Columns: []*migration.Column{
                    {Name: "id", Type: migration.ColumnTypeBigInt, PrimaryKey: true, AutoIncrement: true},
                    {Name: "user_id", Type: migration.ColumnTypeBigInt, NotNull: true},
                    {Name: "title", Type: migration.ColumnTypeVarchar, Length: 200, NotNull: true},
                    {Name: "content", Type: migration.ColumnTypeText},
                    {Name: "status", Type: migration.ColumnTypeVarchar, Length: 20, Default: "'draft'"},
                    {Name: "created_at", Type: migration.ColumnTypeDateTime, Default: "CURRENT_TIMESTAMP"},
                    {Name: "updated_at", Type: migration.ColumnTypeDateTime, Default: "CURRENT_TIMESTAMP"},
                },
                ForeignKeys: []*migration.ForeignKey{
                    {
                        Name:           "fk_posts_user_id",
                        Columns:        []string{"user_id"},
                        ReferencedTable: "users",
                        ReferencedColumns: []string{"id"},
                        OnDelete:       "CASCADE",
                        OnUpdate:       "CASCADE",
                    },
                },
            }
            
            schema := migration.NewSchemaBuilder(conn)
            return schema.CreateTable(table)
        },
        func(conn db.ConnectionInterface) error {
            schema := migration.NewSchemaBuilder(conn)
            return schema.DropTable("posts")
        },
    )
    
    // æ‰§è¡Œè¿ç§»
    err = migrator.Up()
    if err != nil {
        fmt.Printf("è¿ç§»å¤±è´¥: %v\n", err)
        return
    }
    fmt.Println("âœ… æ•°æ®åº“è¿ç§»å®Œæˆ!")
    
    // æ˜¾ç¤ºè¿ç§»çŠ¶æ€
    migrator.PrintStatus()
    
    // æ¼”ç¤ºå›æ»šæœ€åä¸€ä¸ªè¿ç§»
    fmt.Println("\nğŸ”„ æ¼”ç¤ºå›æ»šæœ€åä¸€ä¸ªè¿ç§»...")
    err = migrator.Down()
    if err != nil {
        fmt.Printf("å›æ»šå¤±è´¥: %v\n", err)
    } else {
        fmt.Println("âœ… å›æ»šæˆåŠŸ!")
        migrator.PrintStatus()
    }
}</code></pre>
                    </div>
                    <div class="tab-content" id="transaction">
                        <pre><code class="language-go">package main

import (
    "fmt"
    "log"
    
    "github.com/zhoudm1743/torm/db"
)

// è´¦æˆ·æ“ä½œä¸šåŠ¡é€»è¾‘ - å®Œå…¨åŸºäºæŸ¥è¯¢æ„å»ºå™¨
func createAccount(userID int64, initialBalance float64) (int64, error) {
    query, err := db.Table("accounts")
    if err != nil {
        return 0, err
    }
    
    return query.Insert(map[string]interface{}{
        "user_id":    userID,
        "balance":    initialBalance,
        "status":     "active",
        "created_at": "2024-01-01 10:00:00",
        "updated_at": "2024-01-01 10:00:00",
    })
}

func getAccountBalance(userID int64) (float64, error) {
    query, err := db.Table("accounts")
    if err != nil {
        return 0, err
    }
    
    account, err := query.Select("balance").Where("user_id", "=", userID).First()
    if err != nil {
        return 0, err
    }
    
    // TORMè¿”å›çš„æ˜¯map[string]interface{}ï¼Œéœ€è¦ç±»å‹æ–­è¨€
    balance, ok := account["balance"].(float64)
    if !ok {
        // å°è¯•å…¶ä»–å¯èƒ½çš„æ•°å­—ç±»å‹
        if intVal, ok := account["balance"].(int64); ok {
            balance = float64(intVal)
        } else {
            return 0, fmt.Errorf("ä½™é¢æ•°æ®ç±»å‹é”™è¯¯")
        }
    }
    
    return balance, nil
}

func updateAccountBalance(userID int64, newBalance float64) error {
    query, err := db.Table("accounts")
    if err != nil {
        return err
    }
    
    affected, err := query.Where("user_id", "=", userID).Update(map[string]interface{}{
        "balance":    newBalance,
        "updated_at": "2024-01-01 11:00:00",
    })
    
    if err != nil {
        return err
    }
    
    if affected == 0 {
        return fmt.Errorf("è´¦æˆ·ä¸å­˜åœ¨")
    }
    
    return nil
}

func createTransferLog(fromUserID, toUserID int64, amount float64) error {
    query, err := db.Table("transfer_logs")
    if err != nil {
        return err
    }
    
    _, err = query.Insert(map[string]interface{}{
        "from_user_id": fromUserID,
        "to_user_id":   toUserID,
        "amount":       amount,
        "status":       "completed",
        "created_at":   "2024-01-01 11:00:00",
    })
    
    return err
}

// è½¬è´¦ç¤ºä¾‹ - æŸ¥è¯¢æ„å»ºå™¨ + äº‹åŠ¡
func transferMoney(fromUserID, toUserID int64, amount float64) error {
    // äº‹åŠ¡å‰éªŒè¯
    fromBalance, err := getAccountBalance(fromUserID)
    if err != nil {
        return fmt.Errorf("è·å–å‘é€æ–¹ä½™é¢å¤±è´¥: %v", err)
    }
    
    if fromBalance < amount {
        return fmt.Errorf("ä½™é¢ä¸è¶³: å½“å‰ %.2f, éœ€è¦ %.2f", fromBalance, amount)
    }
    
    toBalance, err := getAccountBalance(toUserID)
    if err != nil {
        return fmt.Errorf("è·å–æ¥æ”¶æ–¹ä½™é¢å¤±è´¥: %v", err)
    }
    
    // ä½¿ç”¨TORMçš„äº‹åŠ¡API
    return db.Transaction(func(tx db.TransactionInterface) error {
        // è®¡ç®—æ–°ä½™é¢
        newFromBalance := fromBalance - amount
        newToBalance := toBalance + amount
        
        // æ›´æ–°å‘é€æ–¹ä½™é¢
        err := updateAccountBalance(fromUserID, newFromBalance)
        if err != nil {
            return fmt.Errorf("æ›´æ–°å‘é€æ–¹ä½™é¢å¤±è´¥: %v", err)
        }
        
        // æ›´æ–°æ¥æ”¶æ–¹ä½™é¢
        err = updateAccountBalance(toUserID, newToBalance)
        if err != nil {
            return fmt.Errorf("æ›´æ–°æ¥æ”¶æ–¹ä½™é¢å¤±è´¥: %v", err)
        }
        
        // è®°å½•è½¬è´¦æ—¥å¿—
        err = createTransferLog(fromUserID, toUserID, amount)
        if err != nil {
            return fmt.Errorf("è®°å½•è½¬è´¦æ—¥å¿—å¤±è´¥: %v", err)
        }
        
        return nil // è‡ªåŠ¨æäº¤äº‹åŠ¡
    })
}

func main() {
    // é…ç½®æ•°æ®åº“
    config := &db.Config{
        Driver:   "sqlite", 
        Database: "bank.db",
    }
    
    err := db.AddConnection("default", config)
    if err != nil {
        log.Fatal(err)
    }
    
    // ä½¿ç”¨ä¸šåŠ¡å‡½æ•°åˆ›å»ºæµ‹è¯•è´¦æˆ·
    fmt.Println("ğŸ¦ åˆ›å»ºé“¶è¡Œè´¦æˆ·...")
    account1ID, err := createAccount(1, 1000.00)
    if err != nil {
        log.Fatal(err)
    }
    
    account2ID, err := createAccount(2, 500.00)
    if err != nil {
        log.Fatal(err)
    }
    
    fmt.Printf("âœ… åˆ›å»ºè´¦æˆ·: %v, %v\n", account1ID, account2ID)
    
    // æ˜¾ç¤ºè½¬è´¦å‰ä½™é¢
    fmt.Println("ğŸ’° è½¬è´¦å‰ä½™é¢:")
    balance1, _ := getAccountBalance(1)
    balance2, _ := getAccountBalance(2)
    fmt.Printf("  ç”¨æˆ· 1: %.2f\n", balance1)
    fmt.Printf("  ç”¨æˆ· 2: %.2f\n", balance2)
    
    // æ‰§è¡Œè½¬è´¦äº‹åŠ¡
    fmt.Println("\nğŸ”„ æ‰§è¡Œè½¬è´¦...")
    err = transferMoney(1, 2, 100.00)
    if err != nil {
        fmt.Printf("âŒ è½¬è´¦å¤±è´¥: %v\n", err)
    } else {
        fmt.Println("âœ… è½¬è´¦æˆåŠŸ!")
        
        // æŸ¥è¯¢è½¬è´¦åçš„ä½™é¢
        fmt.Println("\nğŸ’° è½¬è´¦åä½™é¢:")
        newBalance1, _ := getAccountBalance(1)
        newBalance2, _ := getAccountBalance(2)
        fmt.Printf("  ç”¨æˆ· 1: %.2f (å˜åŒ–: %.2f)\n", newBalance1, newBalance1-balance1)
        fmt.Printf("  ç”¨æˆ· 2: %.2f (å˜åŒ–: %.2f)\n", newBalance2, newBalance2-balance2)
        
        // æŸ¥è¯¢è½¬è´¦è®°å½•
        logQuery, _ := db.Table("transfer_logs")
        logs, err := logQuery.
            Select("from_user_id", "to_user_id", "amount", "status").
            Where("from_user_id", "=", 1).
            Where("to_user_id", "=", 2).
            Get()
        if err == nil && len(logs) > 0 {
            log := logs[0]
            fmt.Printf("\nğŸ“‹ è½¬è´¦è®°å½•: ç”¨æˆ·%v -> ç”¨æˆ·%v, é‡‘é¢: %.2f, çŠ¶æ€: %s\n",
                log["from_user_id"], log["to_user_id"], log["amount"], log["status"])
        }
    }
    
    // æ¼”ç¤ºäº‹åŠ¡å›æ»š
    fmt.Println("\nğŸ”„ æ¼”ç¤ºäº‹åŠ¡å›æ»š...")
    err = transferMoney(1, 2, 10000.00)
    if err != nil {
        fmt.Printf("âœ… æ­£ç¡®å›æ»š: %v\n", err)
    }
}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- èµåŠ©å•†åŒºåŸŸ -->
        <section class="sponsors">
            <div class="container">
                <h2 class="section-title">æ„Ÿè°¢æˆ‘ä»¬çš„èµåŠ©å•†</h2>
                <div class="sponsor-tiers">
                    <div class="sponsor-tier">
                        <h3>ç™½é‡‘èµåŠ©å•†</h3>
                        <div class="sponsor-cards">
                            <div class="sponsor-card placeholder">
                                <span>æˆä¸ºèµåŠ©å•†</span>
                            </div>
                        </div>
                    </div>
                    <div class="sponsor-tier">
                        <h3>é»„é‡‘èµåŠ©å•†</h3>
                        <div class="sponsor-cards">
                            <div class="sponsor-card placeholder">
                                <span>æˆä¸ºèµåŠ©å•†</span>
                            </div>
                            <div class="sponsor-card placeholder">
                                <span>æˆä¸ºèµåŠ©å•†</span>
                            </div>
                            <div class="sponsor-card placeholder">
                                <span>æˆä¸ºèµåŠ©å•†</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>TORM</h4>
                    <p>Goè¯­è¨€çš„ä¼˜é›…ORMåº“</p>
                </div>
                <div class="footer-section">
                    <h4>æ–‡æ¡£</h4>
                    <a href="docs.html?doc=quick-start">å¿«é€Ÿå¼€å§‹</a>
                    <a href="docs.html?doc=configuration">é…ç½®æŒ‡å—</a>
                    <a href="#">APIå‚è€ƒ</a>
                </div>
                <div class="footer-section">
                    <h4>ç¤¾åŒº</h4>
                    <a href="https://github.com/zhoudm1743/torm" target="_blank">GitHub</a>
                    <a href="#">è®¨è®ºåŒº</a>
                    <a href="docs.html?doc=contributing">è´¡çŒ®æŒ‡å—</a>
                </div>
                <div class="footer-section">
                    <h4>å…¶ä»–</h4>
                    <a href="docs.html?doc=changelog">æ›´æ–°æ—¥å¿—</a>
                    <a href="https://github.com/zhoudm1743/torm/issues" target="_blank">é—®é¢˜åé¦ˆ</a>
                    <a href="docs.html?doc=troubleshooting">æ•…éšœæ’é™¤</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 TORM. <a href="https://beian.miit.gov.cn/" style="color: #fff;text-decoration: none;">æµ™ICPå¤‡19007147å·-3</a></p>
            </div>
        </div>
    </footer>

    <script src="scripts/config.js"></script>
    <script src="scripts/main.js"></script>
</body>
</html> 